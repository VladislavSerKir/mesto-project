(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{xN:()=>A,zk:()=>j,O9:()=>U,rN:()=>z,D2:()=>w,Rf:()=>T,iZ:()=>M,UY:()=>H});var e=document.querySelector(".popup_type_image");function n(t){t.classList.add("popup_opened"),document.addEventListener("keydown",r)}function o(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",r)}function r(t){"Escape"===t.key&&o(document.querySelector(".popup_opened"))}document.querySelectorAll(".popup").forEach((function(t){t.addEventListener("mousedown",(function(e){e.target.classList.contains("popup_opened")&&o(t),e.target.classList.contains("popup__close-button")&&o(t)}))}));var c=e.querySelector(".popup__image"),a=e.querySelector(".popup__text"),i=(Array.from(document.querySelectorAll(".popup")),document.querySelector(".popup_type_card")),u=document.querySelector(".profile__edit-button"),l=document.querySelector(".profile__add-button"),s=document.querySelector(".profile__avatar-link"),d=document.querySelector(".popup_type_avatar"),f=document.querySelector(".popup_type_confirm");function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var m,h={baseUrl:"https://nomoreparties.co/v1",cohortId:"plus-cohort-13",headers:{authorization:"c78a0ff3-e5d6-4d7f-a1e3-4df178535103","Content-Type":"application/json"}};function y(t){return t.ok?t.json():Promise.reject("Ошибка:".concat(t.status," ").concat(t.statusText))}Promise.all([(m=h,fetch("".concat(m.baseUrl,"/").concat(m.cohortId,"/users/me"),{method:"GET",headers:{authorization:m.headers.authorization,"Content-Type":"application/json"}}).then(y)),function(t){return fetch("".concat(t.baseUrl,"/").concat(t.cohortId,"/cards"),{method:"GET",headers:{authorization:t.headers.authorization,"Content-Type":"application/json"}}).then(y)}(h)]).then((function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c=[],a=!0,i=!1;try{for(n=n.call(t);!(a=(o=n.next()).done)&&(c.push(o.value),!e||c.length!==e);a=!0);}catch(t){i=!0,r=t}finally{try{a||null==n.return||n.return()}finally{if(i)throw r}}return c}}(e,n)||function(t,e){if(t){if("string"==typeof t)return p(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],c=o[1];return j.textContent=r.name,z.textContent=r.about,A.src=r.avatar,M.id=r._id,H(c),c})).catch((function(t){console.log("Ошибка: ".concat(t.status,", ").concat(t.statusText))}));var _,v,b=document.querySelector("#cards"),S=b.querySelector("#card");function q(t,o){var r=S.content.cloneNode(!0).querySelector(".element");r.id=t._id,r.querySelector(".element__title").textContent=t.name;var i=r.querySelector(".element__delete-button"),u=r.querySelector(".element__image"),l=r.querySelector(".element__likes");return u.setAttribute("src","".concat(t.link)),u.setAttribute("alt","".concat(t.name)),t.likes.length&&(l.textContent=t.likes.length),t.owner._id!==M.id&&i.classList.add("element__delete-button_disabled"),Array.from(t.likes).forEach((function(t){t._id===M.id&&r.querySelector(".element__like-button").classList.add("element__like-button_liked_true")})),i.addEventListener("click",(function(t){o(t,r.id)})),r.querySelector(".element__like-button").addEventListener("click",(function(t){!function(t,e,n){(function(t,e,n,o){return fetch("".concat(t.baseUrl,"/").concat(t.cohortId,"/cards"),{method:"GET",headers:{authorization:t.headers.authorization,"Content-Type":"application/json"}}).then(y)})(h).then((function(e){return e.find((function(e){if(e._id===t.target.closest(".element").id)return e.likes}))})).then((function(o){o.likes.some((function(t){if(t._id===e)return!0}))?function(t,e,n){return fetch("".concat(t.baseUrl,"/").concat(t.cohortId,"/cards/likes/").concat(e.target.closest(".element").id),{method:"DELETE",headers:{authorization:t.headers.authorization,"Content-Type":"application/json"}}).then(y)}(h,t).then((function(e){return e.likes.length?n.textContent=e.likes.length:n.textContent="",t.target.classList.remove("element__like-button_liked_true"),e})):function(t,e,n){return fetch("".concat(t.baseUrl,"/").concat(t.cohortId,"/cards/likes/").concat(e.target.closest(".element").id),{method:"PUT",headers:{authorization:t.headers.authorization,"Content-Type":"application/json"}}).then(y)}(h,t).then((function(e){return n.textContent=e.likes.length,t.target.classList.add("element__like-button_liked_true"),e}))})).catch((function(t){console.log("Ошибка: ".concat(t.status,", ").concat(t.statusText))}))}(t,M.id,l)})),u.addEventListener("click",(function(){return r=(o=t).link,i=o.name,n(e),c.setAttribute("src",r),c.setAttribute("alt",i),void(a.textContent=i);var o,r,i})),r}var k=function(t,e){_=t,v=e,n(f)};f.addEventListener("submit",(function(t){t.preventDefault(),function(t,e){return fetch("".concat(t.baseUrl,"/").concat(t.cohortId,"/cards/").concat(e),{method:"DELETE",headers:{authorization:t.headers.authorization,"Content-Type":"application/json"}}).then(y)}(h,v).then((function(t){return t})).then((function(){_.target.closest(".element").remove()})).then((function(){o(f)})).catch((function(t){console.log("Ошибка: ".concat(t.status,", ").concat(t.statusText))}))}));function g(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?(t.classList.remove(n),t.disabled=!1):(t.classList.add(n),t.disabled=!0)}var C,E,x,L,T=document.querySelector(".popup_type_profile"),j=document.querySelector(".profile__title"),z=document.querySelector(".profile__occupation"),A=document.querySelector(".profile__avatar"),O=document.querySelector("#form-avatar"),I=document.querySelector("#form-profile"),U=I.querySelector(".form__field_profile_name"),w=I.querySelector(".form__field_profile_occupation"),P=document.querySelector("#form-card"),D=P.querySelector(".form__field_card_name"),N=P.querySelector(".form__field_card_link"),B=O.querySelector(".form__field_avatar_link"),G=document.querySelector("#form-profile-button"),J=document.querySelector("#form-avatar-button"),M=document.querySelector(".profile");function H(t){t.forEach((function(t){b.append(q(t,k))}))}P.addEventListener("submit",(function(t){t.preventDefault();var e={};e.name=D.value,e.link=N.value,function(t,e){return fetch("".concat(t.baseUrl,"/").concat(t.cohortId,"/cards"),{method:"POST",headers:{authorization:t.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,link:e.link})}).then(y)}(h,e).then((function(t){return b.prepend(q(t,k)),t})).catch((function(t){console.log("Ошибка: ".concat(t.status,", ").concat(t.statusText))})),P.reset(),o(i)})),I.addEventListener("submit",(function(t){t.preventDefault(),G.textContent="Сохранение...",function(t,e,n){return fetch("".concat(t.baseUrl,"/").concat(t.cohortId,"/users/me"),{method:"PATCH",headers:{authorization:t.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:n})}).then(y)}(h,U.value,w.value).then((function(t){return j.textContent=t.name,z.textContent=t.about,t})).catch((function(t){console.log("Ошибка: ".concat(t.status,", ").concat(t.statusText))})).finally((function(){G.textContent="Сохранить"})),o(T)})),O.addEventListener("submit",(function(t){t.preventDefault(),J.textContent="Сохранение...",function(t,e){return fetch("".concat(t.baseUrl,"/").concat(t.cohortId,"/users/me/avatar"),{method:"PATCH",headers:{authorization:t.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then(y)}(h,B.value).then((function(t){return A.src=t.avatar,t})).catch((function(t){console.log("Ошибка: ".concat(t.status,", ").concat(t.statusText))})).finally((function(){J.textContent="Сохранить"})),O.reset(),o(d)})),u.addEventListener("click",(function(){U.value=j.textContent,w.value=z.textContent,n(T)})),l.addEventListener("click",(function(){n(i)})),s.addEventListener("click",(function(){n(d)})),E=(C={formSelector:".form",inputSelector:".form__field",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_disabled",inputErrorClass:"form__field_type_error",errorClass:"form__field-error_active"}).formSelector,x=function(t,e){if(null==t)return{};var n,o,r=function(t,e){if(null==t)return{};var n,o,r={},c=Object.keys(t);for(o=0;o<c.length;o++)n=c[o],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(o=0;o<c.length;o++)n=c[o],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}(C,["formSelector"]),L=document.querySelectorAll(E),Array.from(L).forEach((function(t){!function(t,e){var n=e.inputSelector,o=e.submitButtonSelector,r=e.inactiveButtonClass,c=e.inputErrorClass,a=Array.from(t.querySelectorAll(n)),i=t.querySelector(o);g(i,a,r),a.forEach((function(e){e.addEventListener("input",(function(){!function(t,e,n){e.validity.valid?function(t,e,n){t.querySelector("#".concat(e.id,"-error")).textContent=e.validationMessage,e.classList.remove(n)}(t,e,n):function(t,e,n){t.querySelector("#".concat(e.id,"-error")).textContent=e.validationMessage,e.classList.add(n)}(t,e,n)}(t,e,c),g(i,a,r)}))})),t.addEventListener("submit",(function(t){t.preventDefault()}))}(t,x)}))})();